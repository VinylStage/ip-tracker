# Nginx ë¡œê·¸ ê¸°ë°˜ IP ì¶”ì  ë° í†µê³„(v0.1.0)

ì´ í”„ë¡œì íŠ¸ëŠ” Nginx ë¡œê·¸ íŒŒì¼ì—ì„œ IP ì£¼ì†Œë¥¼ ì¶”ì í•˜ê³ , ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ í†µê³„ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì˜ ì§€ë¦¬ì  ë¶„í¬ì™€ ì¡°ì§ë³„ ìš”ì²­ ìˆ˜ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“‘ ëª©ì°¨

- [Nginx ë¡œê·¸ ê¸°ë°˜ IP ì¶”ì  ë° í†µê³„(v0.1.0)](#nginx-ë¡œê·¸-ê¸°ë°˜-ip-ì¶”ì -ë°-í†µê³„v010)
  - [ğŸ“‘ ëª©ì°¨](#-ëª©ì°¨)
  - [âš™ï¸ ë™ì‘ í”„ë¡œì„¸ìŠ¤](#ï¸-ë™ì‘-í”„ë¡œì„¸ìŠ¤)
  - [ğŸ§ª ì‚¬ìš©ë²•](#-ì‚¬ìš©ë²•)
  - [ğŸ—‚ ìƒì„±ë˜ëŠ” íŒŒì¼ ëª©ë¡](#-ìƒì„±ë˜ëŠ”-íŒŒì¼-ëª©ë¡)
  - [ğŸ“Š ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ](#-ë¶„ì„-ê²°ê³¼-ì˜ˆì‹œ)

---

## âš™ï¸ ë™ì‘ í”„ë¡œì„¸ìŠ¤

1. ë¡œê·¸ì—ì„œ IP ì¶”ì¶œ

    - `extract_ips_from_log.py`

2. ì¤‘ë³µ IPì£¼ì†Œ ì œê±° ë° ë¶„ë¦¬ê¸°ë¡

    - `deduplicate_ip_list.py`

3. `ipwho.is`ì— ìš”ì²­í•˜ì—¬ ì •ë³´ ì¶”ì¶œ

    - `trace_ip_locations.py`

4. ê¸°ë¡ëœ ì •ë³´ë¥¼ í† ëŒ€ë¡œ `stats_summary.csv`ì— í†µê³„ ê¸°ë¡

   - `analyze_and_output_stats.py`
   - êµ­ê°€, ì§€ì—­, ì¡°ì§, ëŒ€ë¥™ë³„ ìš”ì²­ìˆ˜ ìˆœìœ„ í†µê³„

---

## ğŸ§ª ì‚¬ìš©ë²•

1. ê°€ìƒí™˜ê²½ ì„¤ì •

```bash
python3 -m venv venv
```

or

```bash
poetry shell
```

2. ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜

ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” `poetry`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ `pip`ë„ ì§€ì›ë©ë‹ˆë‹¤.

- `poetry`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

```bash
pip install -r requirements.txt
```

or

```bash
poetry install
```

3. ë¡œê·¸íŒŒì¼ ì¤€ë¹„

```bash
mkdir -p data
```

- `data` ë””ë ‰í† ë¦¬ í•˜ìœ„ì— `raw_log.json` ì´ë¦„ìœ¼ë¡œ ì—”ì§„ì—‘ìŠ¤ ì»¨í…Œì´ë„ˆ ë¡œê·¸ ì €ì¥ (JSON Lines í˜•ì‹ìœ¼ë¡œ ì €ì¥)

- `data` ë””ë ‰í† ë¦¬ í•˜ìœ„ì— `raw_log.json` ì´ë¦„ìœ¼ë¡œ ì—”ì§„ì—‘ìŠ¤ ì»¨í…Œì´ë„ˆ ë¡œê·¸ ì €ì¥
- í˜„ì¬ë¡œì¨ëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ ì¶”ì¶œí•œ ì—”ì§„ì—‘ìŠ¤ ì»¨í…Œì´ë„ˆì˜ raw ë¡œê·¸ë§Œ ì·¨ê¸‰

>ì˜ˆì‹œ

```json
{"log":"2025/04/10 07:43:36 [notice] 1#1: start worker process 9\n","stream":"stderr","time":"2025-04-10T07:43:36.00728926Z"}
{"log":"175.209.248.172 - - [10/Apr/2025:07:46:30 +0000] \"GET /docs HTTP/1.1\" 200 938 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0\" \"-\"\n","stream":"stdout","time":"2025-04-10T07:46:30.630969002Z"}
# â†‘ ì—¬ê¸°ì„œ IP "175.209.248.172" ì´ ì¶”ì¶œë©ë‹ˆë‹¤
```

4. í”„ë¡œê·¸ë¨ ì‹¤í–‰

- windows í˜¹ì€ ê¸°íƒ€ alias ì„¤ì •ëœ í™˜ê²½

```bash
python main.py
```

- unix í™˜ê²½

```bash
python3 main.py
```

---

## ğŸ—‚ ìƒì„±ë˜ëŠ” íŒŒì¼ ëª©ë¡

- `data/ip_list.txt`: ë¡œê·¸ì—ì„œ ì¶”ì¶œëœ IP ë¦¬ìŠ¤íŠ¸ (ì¤‘ë³µ í¬í•¨, ì¤‘ê°„ ì¶œë ¥ íŒŒì¼ë¡œ ìµœì¢… ì¤‘ë³µ ì œê±°ëœ ëª©ë¡ì€ ì•„ë‹˜). ì´ íŒŒì¼ì€ ì¶”ì¶œëœ ëª¨ë“  IP ì£¼ì†Œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- `data/ip_list.txt.dedup`: ì¤‘ë³µ ì œê±°ëœ ê³ ìœ  IP ëª©ë¡. ë¶„ì„ì— ì‚¬ìš©ë  ê³ ìœ  IP ì£¼ì†Œë§Œ í¬í•¨í•©ë‹ˆë‹¤.
- `data/ip_info.jsonl`: ê° IPì— ëŒ€í•œ ìœ„ì¹˜ ì •ë³´ (JSON Lines í˜•ì‹). IP ì£¼ì†Œë³„ë¡œ ìœ„ì¹˜ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- `data/stats_summary.txt`: ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í†µê³„ ìš”ì•½. ì£¼ìš” í†µê³„ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.
- `data/stats_summary.csv`: ì •ë ¬ ë° ì‹œê°í™”ì— ìš©ì´í•œ í†µê³„ í…Œì´ë¸” (CSV í¬ë§·). í†µê³„ ë°ì´í„°ë¥¼ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ì—¬ ë¶„ì„ ë° ì‹œê°í™”ì— ì í•©í•©ë‹ˆë‹¤.

---

## ğŸ“Š ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ

`data/stats_summary.csv` ì˜ˆì‹œ:

```Plain Text
category,value,count
country,KR,127
region,Seoul,58
continent,Asia,180
org,SK Broadband,76
```
